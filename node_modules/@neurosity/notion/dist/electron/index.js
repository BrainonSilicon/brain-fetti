process.env.HMR_PORT=0;process.env.HMR_HOSTNAME="localhost";parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"TX5A":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.config={apiKey:"AIzaSyB0TkZ83Fj0CIzn8AAmE-Osc92s3ER8hy8",authDomain:"neurosity-device.firebaseapp.com",databaseURL:"https://neurosity-device.firebaseio.com",projectId:"neurosity-device",storageBucket:"neurosity-device.appspot.com",messagingSenderId:"212595049674"};
},{}],"mSvX":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,i,t,n){return new(t||(t=Promise))(function(o,c){function s(e){try{u(n.next(e))}catch(i){c(i)}}function r(e){try{u(n.throw(e))}catch(i){c(i)}}function u(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t(function(e){e(i)})).then(s,r)}u((n=n.apply(e,i||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.createDeviceStore=((i,t,n)=>{const o=i.database().ref(`devices/${t}`),c=o.child("subscriptions").push().key,s=o.child(`clients/${c}`);i.database().ref(".info/connected").on("value",e=>{e.val()&&s.onDisconnect().remove().then(()=>{s.set(n)})});const r=(e,i)=>o.child(e).set(i),u=(e="value",i,t)=>o.child(i).on(e,e=>{t(e.val(),e)}),l=(e,i,t)=>{t?o.child(e).off(i,t):o.child(e).off(i)};return{set:r,once:(i,t="value")=>e(void 0,void 0,void 0,function*(){return(yield o.child(i).once(t)).val()}),update:(e,i)=>{o.child(e).update(i)},lastOfChildValue:(i,t,n)=>e(void 0,void 0,void 0,function*(){const e=(yield o.child(i).orderByChild(t).equalTo(n).limitToLast(1).once("value")).val(),[c]=Object.values(e||{});return c||null}),onNamespace:(e,i)=>u("value",e,e=>{null!==e&&i(e)}),offNamespace:(e,i)=>{l(e,"value",i)},dispatchAction:i=>e(void 0,void 0,void 0,function*(){const e=yield((e,i)=>o.child(e).push(i))("actions",i),t=e.key,n=`actions/${t}`;if(e.onDisconnect().remove(),i.responseRequired){const t=i.responseTimeout||6e5,o=new Promise((i,n)=>{const o=setTimeout(()=>{clearTimeout(o),e.remove(),n(`Action response timed out in ${t}ms.`)},t)}),c=new Promise(e=>{((e,i,t,n)=>{u(e,i,o=>{null!==o&&(l(i,e),t(n||o))})})("value",`${n}/response`,e)});return Promise.race([c,o])}return t}),nextMetric:(i,t)=>e(void 0,void 0,void 0,function*(){r(`metrics/${i}`,t)}),onMetric:(e,i)=>{const{atomic:t,metric:n,labels:o}=e,c=t?`metrics/${n}`:`metrics/${n}/${o[0]}`;return u("value",c,e=>{null!==e&&i(e)})},subscribeToMetric:e=>{const i=o.child("subscriptions").push().key,t=`subscriptions/${i}`,n=Object.assign({id:i,clientId:c},e);return r(t,n),o.child(t).onDisconnect().remove(),n},unsubscribFromMetric:(e,i)=>{l("value",i),(e=>{o.child(e).remove()})(`subscriptions/${e.id}`)}}});
},{}],"kM30":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(n,s){function a(e){try{u(r.next(e))}catch(t){s(t)}}function o(e){try{u(r.throw(e))}catch(t){s(t)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(a,o)}u((r=r.apply(e,t||[])).next())})},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const i=require("rxjs"),r=t(require("firebase/app"));require("firebase/database"),require("firebase/functions"),require("firebase/auth");const n=require("./config"),s=require("./deviceStore"),a=r.default.database.ServerValue.TIMESTAMP;function o(...e){return new r.default.User(...e)}exports.credentialWithLink=r.default.auth.EmailAuthProvider.credentialWithLink,exports.createUser=o;class u{constructor(e){this.serverType="firebase",this.init(e)}init(e){this.app=this.getApp(e.deviceId),this.standalone=this.app.name===e.deviceId,this.deviceStore=s.createDeviceStore(this.app,e.deviceId,a),this.app.auth().onAuthStateChanged(e=>{this.user=e})}auth(){return this.app.auth()}onAuthStateChanged(){return new i.Observable(e=>{this.app.auth().onAuthStateChanged(t=>{e.next(t)})})}onLogin(){return new i.Observable(e=>{const t=this.app.auth().onAuthStateChanged(t=>{t&&(e.next(t),e.complete())});return()=>t()})}login(e){if("idToken"in e&&"providerId"in e){const t=new r.default.auth.OAuthProvider(e.providerId).credential(e.idToken);return this.app.auth().signInWithCredential(t)}if("email"in e&&"password"in e){const{email:t,password:i}=e;return this.app.auth().signInWithEmailAndPassword(t,i)}throw new Error("Either email/password or an idToken/providerId is required")}logout(){return this.app.auth().signOut()}getApp(e){const t=e,i=r.default.apps,s="undefined"!=typeof window&&"firebase"in window&&"apps"in window.firebase?window.firebase.apps:[],a=[...i,...s].find(e=>"[DEFAULT]"===e.name&&e.options.databaseURL===n.config.databaseURL);if(a)return a;const o=i.find(e=>e.name===t);return o||r.default.initializeApp(n.config,t)}dispatchAction(e){return this.deviceStore.dispatchAction(e)}getInfo(){return e(this,void 0,void 0,function*(){return yield this.deviceStore.once("info")})}getSkill(t){return e(this,void 0,void 0,function*(){return yield this.deviceStore.lastOfChildValue("skills","bundleId",t)})}onNamespace(e,t){return this.deviceStore.onNamespace(e,t)}offNamespace(e,t){this.deviceStore.offNamespace(e,t)}getTimesync(){return e(this,void 0,void 0,function*(){return(yield this.dispatchAction({command:"timesync",action:"get",responseRequired:!0,responseTimeout:250})).timestamp})}httpsCallable(e,t){return this.app.functions().httpsCallable(e)(t)}nextMetric(e,t){this.deviceStore.nextMetric(e,t)}onMetric(e,t){this.deviceStore.onMetric(e,t)}subscribeToMetric(e){return this.deviceStore.subscribeToMetric(e)}unsubscribFromMetric(e,t){this.deviceStore.unsubscribFromMetric(e,t)}get timestamp(){return a}changeSettings(t){return e(this,void 0,void 0,function*(){return this.deviceStore.update("settings",t)})}disconnect(){return this.standalone?this.app.delete():Promise.resolve()}}exports.FirebaseClient=u;
},{"./config":"TX5A","./deviceStore":"mSvX"}],"nVpT":[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("socket.io-client"));class s{constructor(t){this.serverType="websocket",this.socket=e.default(t.socketUrl,{path:`/${t.deviceId}`}),this.init()}onMetric(t,e){return this.socket.on(`metrics/${t.id}`,e)}init(){this.socket.connected||this.socket.connect()}disconnect(){this.socket.connected&&this.socket.disconnect()}}exports.WebsocketClient=s;
},{}],"iVIU":[function(require,module,exports) {
"use strict";var t=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))(function(s,n){function o(t){try{a(i.next(t))}catch(e){n(e)}}function u(t){try{a(i.throw(t))}catch(e){n(e)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(o,u)}a((i=i.apply(t,e||[])).next())})},e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const r=require("rxjs"),i=require("rxjs/operators"),s=require("rxjs/operators"),n=e(require("outliers")),o={bufferSize:100,updateInterval:6e4};class u{constructor(t){this._offset=0,this.options=Object.assign(Object.assign({},o),t),this.starTimer()}starTimer(){const{bufferSize:t,updateInterval:e}=this.options,n=r.range(0,t),o=r.timer(e,e).pipe(i.map(e=>t+e));n.pipe(i.concat(o),this.toOffset(),s.bufferCount(t,1),this.filterOutliers(),i.map(t=>this.average(t))).subscribe(t=>{this._offset=t})}filterOutliers(){return r.pipe(i.map(t=>t.filter(n.default())))}toOffset(){const{getTimesync:e}=this.options;return r.pipe(s.concatMap(()=>t(this,void 0,void 0,function*(){const t=Date.now(),[r,i]=yield e().then(t=>[null,t]).catch(t=>[t]);if(r)return console.log(r),0;const s=Date.now();return s-(s-t)/2-i})))}average(t){return Math.round(t.reduce((t,e)=>t+e)/t.length)}get offset(){return this._offset}get timestamp(){return Date.now()+this._offset}}exports.Timesync=u;
},{}],"CXqr":[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./Timesync"));
},{"./Timesync":"iVIU"}],"LXvB":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(r,n){function c(e){try{a(s.next(e))}catch(t){n(t)}}function o(e){try{a(s.throw(e))}catch(t){n(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(c,o)}a((s=s.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("@neurosity/ipk"),i=require("./firebase/index"),s=require("./websocket"),r=require("../timesync"),n=e=>Object.keys(t.metrics).includes(e);var c=require("./firebase");exports.credentialWithLink=c.credentialWithLink,exports.createUser=c.createUser;class o{constructor(e){this.options=e,this.firebase=new i.FirebaseClient(e),this.firebase.onAuthStateChanged().subscribe(e=>{this.user=e}),this.options.timesync&&this.firebase.onLogin().subscribe(()=>{this.timesync=new r.Timesync({getTimesync:this.firebase.getTimesync.bind(this.firebase)})}),e.onDeviceSocketUrl&&(this.onDeviceSocket=new s.WebsocketClient({deviceId:e.deviceId,socketUrl:e.onDeviceSocketUrl}))}get actions(){return{dispatch:e=>this.firebase.dispatchAction(e)}}disconnect(){return e(this,void 0,void 0,function*(){return this.onDeviceSocket&&this.onDeviceSocket.disconnect(),this.firebase.disconnect()})}getInfo(){return e(this,void 0,void 0,function*(){return yield this.firebase.getInfo()})}login(t){return e(this,void 0,void 0,function*(){return yield this.firebase.login(t)})}logout(){return e(this,void 0,void 0,function*(){return yield this.firebase.logout()})}auth(){return this.firebase.auth()}onAuthStateChanged(){return this.firebase.onAuthStateChanged()}onNamespace(e,t){return this.firebase.onNamespace(e,t)}offNamespace(e,t){this.firebase.offNamespace(e,t)}get metrics(){const e=e=>this.onDeviceSocket&&n(e);return{next:(e,t)=>{this.firebase.nextMetric(e,t)},on:(t,i)=>e(t.metric)?this.onDeviceSocket.onMetric(t,i):this.firebase.onMetric(t,i),subscribe:t=>{const i=e(t.metric)?this.onDeviceSocket.serverType:this.firebase.serverType;return this.firebase.subscribeToMetric(Object.assign(Object.assign({},t),{serverType:i}))},unsubscribe:(e,t)=>{this.firebase.unsubscribFromMetric(e,t)}}}httpsCallable(e,t){return this.firebase.httpsCallable(e,t)}get skills(){return{get:t=>e(this,void 0,void 0,function*(){return this.firebase.getSkill(t)})}}get timestamp(){return this.options.timesync?this.timesync.timestamp:Date.now()}changeSettings(e){return this.firebase.changeSettings(e)}}exports.ApiClient=o;
},{"./firebase/index":"kM30","./websocket":"nVpT","../timesync":"CXqr","./firebase":"kM30"}],"yLLB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("@neurosity/ipk");exports.getLabels=(s=>Object.keys(e.metrics[s])),exports.hasInvalidLabels=((e,s)=>{const r=exports.getLabels(e);return!s.every(e=>r.includes(e))}),exports.isMetricDisallowed=((e,s)=>"skill"in s&&"metrics"in s.skill&&!s.skill.metrics.includes(e)),exports.validate=((e,s,r)=>{const i=exports.getLabels(e).join(", ");return s.length?exports.isMetricDisallowed(e,r)?new Error(`No permission to access the ${e} metric. To access this metric, edit the skill's permissions`):!!exports.hasInvalidLabels(e,s)&&new Error(`One ore more labels provided to ${e} are invalid. The valid labels for ${e} are ${i}`):new Error(`At least one label is required for ${e} metric. Please add one of the following labels: ${i}`)});
},{}],"KQ4u":[function(require,module,exports) {
"use strict";var t=this&&this.__awaiter||function(t,i,e,s){return new(e||(e=Promise))(function(r,n){function a(t){try{o(s.next(t))}catch(i){n(i)}}function c(t){try{o(s.throw(t))}catch(i){n(i)}}function o(t){var i;t.done?r(t.value):(i=t.value,i instanceof e?i:new e(function(t){t(i)})).then(a,c)}o((s=s.apply(t,i||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const i=require("rxjs"),e=require("rxjs/operators"),s=require("./api/index"),r=require("./utils/subscription");class n{constructor(t){if(this.getMetric=(t=>{const{metric:e,labels:s,atomic:n}=t,a=r.validate(e,s,this.options);return a?i.throwError(a):new i.Observable(t=>{const i=(n?[this.api.metrics.subscribe({metric:e,labels:s,atomic:n})]:s.map(t=>this.api.metrics.subscribe({metric:e,labels:[t],atomic:n}))).map(i=>({subscription:i,listener:this.api.metrics.on(i,(...i)=>{t.next(...i)})}));return()=>{i.forEach(({subscription:t,listener:i})=>{this.api.metrics.unsubscribe(t,i)})}})}),this.options=Object.freeze(t),this.api=new s.ApiClient(this.options),!this.options.deviceId)throw new Error("Notion: deviceId is mandatory")}login(i){return t(this,void 0,void 0,function*(){return yield this.api.login(i)})}logout(){return t(this,void 0,void 0,function*(){return yield this.api.logout()})}auth(){return this.api.auth()}onAuthStateChanged(){return this.api.onAuthStateChanged()}getInfo(){return t(this,void 0,void 0,function*(){return yield this.api.getInfo()})}disconnect(){return t(this,void 0,void 0,function*(){return yield this.api.disconnect()})}dispatchAction(t){return this.api.actions.dispatch(t)}addMarker(t){if(!t)throw new Error("Notion: a label is required for addMarker");this.dispatchAction({command:"marker",action:"add",message:{label:t,timestamp:this.api.timestamp}})}awareness(t,...i){return this.getMetric({metric:"awareness",labels:t?[t,...i]:[],atomic:!1})}brainwaves(t,...i){return this.getMetric({metric:"brainwaves",labels:t?[t,...i]:[],atomic:!1})}calm(){return this.awareness("calm")}signalQuality(){return this.getMetric({metric:"signalQuality",labels:r.getLabels("signalQuality"),atomic:!0})}emotion(t,...i){return this.getMetric({metric:"emotion",labels:t?[t,...i]:[],atomic:!1})}settings(){return new i.Observable(t=>{const i=this.api.onNamespace("settings",i=>{t.next(i)});return()=>this.api.offNamespace("settings",i)})}focus(){return this.awareness("focus")}kinesis(t,...i){return this.getMetric({metric:"kinesis",labels:t?[t,...i]:[],atomic:!1})}predictions(t,...i){return this.getMetric({metric:"predictions",labels:t?[t,...i]:[],atomic:!1})}status(){return new i.Observable(t=>{const e=i.timer(0,1e3).subscribe(t=>{this.api.httpsCallable("updateDeviceStatus",{deviceId:this.options.deviceId}).catch(console.error)}),s=this.api.onNamespace("status",i=>{t.next(i)});return()=>{e.unsubscribe(),this.api.offNamespace("status",s)}})}changeSettings(t){return this.api.changeSettings(t)}get training(){return{record:t=>{const i=this.api.user&&"uid"in this.api.user?this.api.user.uid:null,e=Object.assign(Object.assign({fit:!1,baseline:!1,timestamp:this.api.timestamp},t),{userId:i});this.api.actions.dispatch({command:"training",action:"record",message:e})},stop:t=>{this.api.actions.dispatch({command:"training",action:"stop",message:Object.assign({},t)})},stopAll:()=>{this.api.actions.dispatch({command:"training",action:"stopAll",message:{}})}}}skill(s){return t(this,void 0,void 0,function*(){const t=yield this.api.skills.get(s);return null===t?Promise.reject(new Error(`Access denied for: ${s}. Make sure the skill is installed.`)):{metric:s=>{const r=`skill~${t.id}~${s}`,n=new i.Observable(t=>{const i=this.api.metrics.subscribe({metric:r,labels:[s],atomic:!0}),e=this.api.metrics.on(i,(...i)=>{t.next(...i)});return()=>{this.api.metrics.unsubscribe(i,e)}}).pipe(e.map(t=>t[s]));return Object.defineProperty(n,"next",{value:t=>{this.api.metrics.next(r,{[s]:t})}}),n}}})}}exports.Notion=n,n.credentialWithLink=s.credentialWithLink,n.createUser=s.createUser;
},{"./api/index":"LXvB","./utils/subscription":"yLLB"}],"DCNc":[function(require,module,exports) {
"use strict";var n=this&&this.__awaiter||function(n,t,e,i){return new(e||(e=Promise))(function(o,r){function s(n){try{l(i.next(n))}catch(t){r(t)}}function c(n){try{l(i.throw(n))}catch(t){r(t)}}function l(n){var t;n.done?o(n.value):(t=n.value,t instanceof e?t:new e(function(n){n(t)})).then(s,c)}l((i=i.apply(n,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../Notion");function e(e){return n(this,void 0,void 0,function*(){const n=new t.Notion(e),i=Object.assign(Object.assign({},yield n.skill(e.skill.bundleId)),{props:"props"in e.skill?e.skill.props:{}});return delete n.skill,[n,i]})}exports.createNotionOnDevice=e;
},{"../Notion":"KQ4u"}],"T9Vd":[function(require,module,exports) {
"use strict";var n=this&&this.__awaiter||function(n,t,e,i){return new(e||(e=Promise))(function(o,c){function r(n){try{s(i.next(n))}catch(t){c(t)}}function u(n){try{s(i.throw(n))}catch(t){c(t)}}function s(n){var t;n.done?o(n.value):(t=n.value,t instanceof e?t:new e(function(n){n(t)})).then(r,u)}s((i=i.apply(n,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("./NotionOnDevice");function e(e){return{subscribe:i=>n(this,void 0,void 0,function*(){const[o,c]=yield t.createNotionOnDevice(i),r=e(o,c);return{unsubscribe:()=>n(this,void 0,void 0,function*(){if(yield o.disconnect(),r&&"then"in r){const n=yield r;"function"==typeof n&&n()}return"function"==typeof r&&"then"in r()?yield r():"function"==typeof r?r():r})}})}}exports.createSkill=e;
},{"./NotionOnDevice":"DCNc"}],"d8ek":[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./createSkill")),e(require("./NotionOnDevice"));
},{"./createSkill":"T9Vd","./NotionOnDevice":"DCNc"}],"QCba":[function(require,module,exports) {
"use strict";function e(e){for(var r in e)exports.hasOwnProperty(r)||(exports[r]=e[r])}Object.defineProperty(exports,"__esModule",{value:!0}),e(require("./Notion")),e(require("./skills"));
},{"./Notion":"KQ4u","./skills":"d8ek"}]},{},["QCba"], null)
//# sourceMappingURL=/index.js.map